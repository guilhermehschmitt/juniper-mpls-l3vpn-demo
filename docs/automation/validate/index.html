
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Build and deploy a full MPLS network on vMX routers.">
      
      
      
      
        <link rel="canonical" href="https://cdot65.github.io/juniper-mpls-l3vpn-demo/docs/automation/validate/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>validate - Juniper MPLS L3VPN Demo</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
    
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <!-- Additional styles for landing page -->
<style>
  .md-header {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    right: 0;
    left: 0;
    z-index: 2;
    color: #fff;
    background-color: #84b140;
    box-shadow: 0 0 0.2rem transparent, 0 0.2rem 0.4rem transparent;
  }
</style>
<!-- Application header -->
<header class="md-header" data-md-component="header">
  <!-- Top-level navigation -->
  <nav
    class="md-header__inner md-grid"
    aria-label="Header"
  >
    <!-- Link to home -->
    <a
      href="https://cdot65.github.io/juniper-mpls-l3vpn-demo/"
      title="Juniper MPLS L3VPN Demo"
      class="md-header__button md-logo"
      aria-label="Juniper MPLS L3VPN Demo"
    >
      <img
        src="https://raw.githubusercontent.com/cdot65/juniper-mpls-l3vpn-demo/21794c999f67b65d38d7584385721a9ee16aaedc/assets/images/favicon.svg"
      />
    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis"> Juniper MPLS L3VPN Demo </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
             validate 
          </span>
        </div>
      </div>
    </div>

    <!-- Button to open search dialogue -->
    
    <label class="md-header__button md-icon" for="__search">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
    </label>

    <!-- Search interface -->
    
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div> 

    <!-- Repository containing source -->
    
    <div class="md-header__source">
<a href="https://github.com/cdot65/juniper-mpls-l3vpn-demo/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cdot65/juniper-mpls-l3vpn-demo
  </div>
</a></div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Juniper MPLS L3VPN Demo" class="md-nav__button md-logo" aria-label="Juniper MPLS L3VPN Demo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25H1.75zM7.25 8a.75.75 0 0 1-.22.53l-2.25 2.25a.75.75 0 1 1-1.06-1.06L5.44 8 3.72 6.28a.75.75 0 1 1 1.06-1.06l2.25 2.25c.141.14.22.331.22.53zm1.5 1.5a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3z"/></svg>

    </a>
    Juniper MPLS L3VPN Demo
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cdot65/juniper-mpls-l3vpn-demo/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cdot65/juniper-mpls-l3vpn-demo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Documentation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" checked>
      
      <label class="md-nav__link" for="__nav_2_2">
        Automation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Automation" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Automation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_2" type="checkbox" id="__nav_2_2_2" >
      
      <label class="md-nav__link" for="__nav_2_2_2">
        Scripts
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Scripts" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_2">
          <span class="md-nav__icon md-icon"></span>
          Scripts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../configure.py/" class="md-nav__link">
        configure.py
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../generate.py/" class="md-nav__link">
        generate.py
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rollback.py/" class="md-nav__link">
        rollback.py
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../validate.py/" class="md-nav__link">
        validate.py
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_3" type="checkbox" id="__nav_2_2_3" >
      
      <label class="md-nav__link" for="__nav_2_2_3">
        Tools
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tools" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_3">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dockerfile/" class="md-nav__link">
        Dockerfile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../invoke/" class="md-nav__link">
        Invoke
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../poetry/" class="md-nav__link">
        Poetry
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_4" type="checkbox" id="__nav_2_2_4" checked>
      
      <label class="md-nav__link" for="__nav_2_2_4">
        Workflow
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Workflow" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_4">
          <span class="md-nav__icon md-icon"></span>
          Workflow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../configure/" class="md-nav__link">
        configure
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          validate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        validate
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    üìå Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    üêç Files
  </a>
  
    <nav class="md-nav" aria-label="üêç Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validatepy" class="md-nav__link">
    validate.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_l3vpn_routesyaml" class="md-nav__link">
    test_l3vpn_routes.yaml
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#screenshots" class="md-nav__link">
    üì∏ Screenshots
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      <label class="md-nav__link" for="__nav_2_3">
        Network
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Network" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/ip/" class="md-nav__link">
        IP Schema
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/mpls/" class="md-nav__link">
        MPLS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/routing/" class="md-nav__link">
        Routing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      <label class="md-nav__link" for="__nav_2_4">
        Lab Environment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Lab Environment" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Lab Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lab-environment/juniper-vlabs/" class="md-nav__link">
        Juniper vLabs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lab-environment/local/" class="md-nav__link">
        Local
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    üìå Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    üêç Files
  </a>
  
    <nav class="md-nav" aria-label="üêç Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validatepy" class="md-nav__link">
    validate.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_l3vpn_routesyaml" class="md-nav__link">
    test_l3vpn_routes.yaml
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#screenshots" class="md-nav__link">
    üì∏ Screenshots
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cdot65/juniper-mpls-l3vpn-demo/edit/mainline/site/content/docs/automation/validate.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>validate</h1>
                
                <h2 id="overview">üìå Overview</h2>
<p>Our goal here is to use JSNAPy to validate the route table information within our provisioned fabric.</p>
<hr />
<h2 id="files">üêç Files</h2>
<p>Recall that all of our project's automation files are stored within the <a href="https://github.com/cdot65/juniper-mpls-l3vpn-demo/tree/main/files/python">files/python</a> directory.</p>
<div class="highlight"><pre><span></span><code>files/python
‚îú‚îÄ‚îÄ configurations/
‚îú‚îÄ‚îÄ templates/
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ vars/
‚îú‚îÄ‚îÄ configure.py
‚îú‚îÄ‚îÄ download.py
‚îú‚îÄ‚îÄ generate.py
‚îú‚îÄ‚îÄ inventory.yaml
‚îú‚îÄ‚îÄ rollback.py
‚îî‚îÄ‚îÄ validate.py
</code></pre></div>
<p>Our attention in this section will be upon the <code>validate.py</code> script and its associated JSNAPy test file <code>tests/test_l3vpn_routes.yaml</code>.</p>
<h3 id="validatepy"><code>validate.py</code></h3>
<p>Starting off with our imports, let's explain what we're bringing into this script and why.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;validate.py: use JSNAPy to validate the L3VPN circuit.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">jnpr.jsnapy</span> <span class="kn">import</span> <span class="n">SnapAdmin</span>
</code></pre></div>
<p>We see that we are bringing in the core python library <code>os</code>, this will be used very soon to help us figure out what the full path of our python script is.</p>
<p>Our additional import is pulling in <code>SnapAdmin</code> from the <code>jnpr.jsnapy</code> library. This will give us a JSNAPy object that will give us the necessary mechanisms to perform snapshots of our production network.</p>
<hr />
<p>Moving on to our configuration elements, let's briefly discuss what these objects do and why we've included them.</p>
<div class="highlight"><pre><span></span><code><span class="n">PWD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="n">JSNAPY</span> <span class="o">=</span> <span class="n">SnapAdmin</span><span class="p">()</span>

<span class="n">CONFIG</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">hosts:</span>
<span class="s2">  - device: 100.123.1.4</span>
<span class="s2">    username : automation</span>
<span class="s2">    passwd: juniper123</span>
<span class="s2">  - device: 100.123.1.7</span>
<span class="s2">    username : automation</span>
<span class="s2">    passwd: juniper123</span>
<span class="s2">tests:</span>
<span class="s2">  - </span><span class="si">{</span><span class="n">PWD</span><span class="si">}</span><span class="s2">/tests/test_l3vpn_routes.yaml</span>
<span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>
<p>Remember when I mentioned the need to know the current working path of our python script? This is because we are creating an object called PWD, which will be equal to whatever path the script is executed from. If we executed this script from the <code>/home/skillet/</code> directory, the value of <code>PWD</code> would be <code>/home/skillet/</code>. This only matters because we'll need to point JSNAPy to the exact directory of our tests files, or else it'll fall back on the defaults.</p>
<p>We create an instance of the <code>SnapAdmin</code> object class we imported from JSNAPy, and we call the new object JSNAPY. From this point forward, when we want to perform a JSNAPy function, we will call this <code>JSNAPY</code> object created here.</p>
<p>Finally, our configuration file. This is a simple way of passing a YAML file into JSNAPy without needing an extra YAML file. We instead create a multi-line string in a new object called <code>CONFIG</code>, and within this string we have a YAML file contents. Since JSNAPy is expecting a configuration to be passed as a YAML file, this is a clever way of getting away with not needing another file.</p>
<hr />
<p>And to put the cherry on top, our mechanism of executing the Python script.</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Perform our JSNAPy tests.&quot;&quot;&quot;</span>
    <span class="n">JSNAPY</span><span class="o">.</span><span class="n">snapcheck</span><span class="p">(</span><span class="n">CONFIG</span><span class="p">,</span> <span class="s2">&quot;test_l3vpn_routes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>There are thousands of explanations on <code>if __name__ == "__main__":</code> within Python, I will rely on your Google skills to find you the one that makes the most sense. In short, we need this so leave it alone.</p>
<p>We execute our JSNAPy task by calling our object called <code>JSNAPY</code>, asking it for the <code>snapcheck</code> method, and passing in our <code>CONFIG</code> object (really a multi-line YAML string), and a name for our tests.</p>
<p>This will execute JSNAPy with the parameters we have passed within our test file. With such a great segway in place...</p>
<h3 id="test_l3vpn_routesyaml"><code>test_l3vpn_routes.yaml</code></h3>
<p>With our attention now on the JSNAPy test file, we will see that we are actually performing two seperate tests on both routers.</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">tests_include</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;route_table_bgp.l3vpn.0&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;route_table_Customer1.inet.0&quot;</span>
</code></pre></div>
<p>The <code>tests_include</code> statement allows us an easy way to bundle multiple tests within the same file. Make sure the name of the tests here match an actual test below.</p>
<hr />
<p>Our first test will grab the XML output of the command <code>show route table bgp.l3vpn.0</code>, which is the L3VPN route table of a PE router.</p>
<div class="highlight"><pre><span></span><code><span class="nt">route_table_bgp.l3vpn.0</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;show</span><span class="nv"> </span><span class="s">route</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">bgp.l3vpn.0&quot;</span>
  <span class="c1"># - ignore-null: True</span>
  <span class="p p-Indicator">-</span> <span class="nt">iterate</span><span class="p">:</span>
      <span class="nt">xpath</span><span class="p">:</span> <span class="s">&quot;//route-table&quot;</span>
      <span class="nt">id</span><span class="p">:</span> <span class="s">&quot;./table-name&quot;</span>
      <span class="nt">tests</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">not-equal</span><span class="p">:</span> <span class="s">&quot;active-route-count,</span><span class="nv"> </span><span class="s">0&quot;</span>
          <span class="nt">info</span><span class="p">:</span> <span class="s">&quot;Validate</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">routes</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">found</span><span class="nv"> </span><span class="s">within</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">bgp.l3vpn.0</span><span class="nv"> </span><span class="s">table&quot;</span>
          <span class="nt">err</span><span class="p">:</span> <span class="s">&quot;Route</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">{{post[&#39;table-name&#39;]}}</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">zero</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">routes&quot;</span>
</code></pre></div>
<p>With the output captured, we iterate over all of the resulting routing tables (should be just 1), and test to see if the value of <code>active-route-count</code> is not equal to the number zero.</p>
<p>An informational message and error is provided if this route table exists and is currently zero.</p>
<blockquote>
<p><strong>Note</strong>: the commented out <code>ignore-null: True</code> statement will let the test gracefully skip our assertion if the routing table is not found.</p>
</blockquote>
<hr />
<p>We perform a similar test with similar logic against the <code>Customer1.inet.0</code> routing table, which will make sure we have routes within the customer's VRF.</p>
<div class="highlight"><pre><span></span><code><span class="nt">route_table_Customer1.inet.0</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;show</span><span class="nv"> </span><span class="s">route</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">Customer1.inet.0&quot;</span>
  <span class="c1"># - ignore-null: True</span>
  <span class="p p-Indicator">-</span> <span class="nt">iterate</span><span class="p">:</span>
      <span class="nt">xpath</span><span class="p">:</span> <span class="s">&quot;//route-table&quot;</span>
      <span class="nt">id</span><span class="p">:</span> <span class="s">&quot;./table-name&quot;</span>
      <span class="nt">tests</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">not-equal</span><span class="p">:</span> <span class="s">&quot;active-route-count,</span><span class="nv"> </span><span class="s">0&quot;</span>
          <span class="nt">info</span><span class="p">:</span> <span class="s">&quot;Validate</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">routes</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">found</span><span class="nv"> </span><span class="s">within</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Customer1.inet.0</span><span class="nv"> </span><span class="s">table&quot;</span>
          <span class="nt">err</span><span class="p">:</span> <span class="s">&quot;Route</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">{{post[&#39;table-name&#39;]}}</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">zero</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">routes&quot;</span>
</code></pre></div>
<h2 id="screenshots">üì∏ Screenshots</h2>
<p><img alt="python validate.py" src="https://raw.githubusercontent.com/cdot65/juniper-mpls-l3vpn-demo/dev/site/content/assets/images/jsnapy_validate.png" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        <!-- Application footer -->
<footer class="md-footer">
  <!-- Further information -->
  <div class="md-footer-meta md-typeset" style="background-color: #fff">
    <div class="md-footer-meta__inner md-grid" style="background-color: #fff">
      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
        <div
          class="md-footer-copyright__highlight"
          style="color: rgb(38, 38, 38)"
        >
          Copyright &copy; 2022 cdot65
        </div>
        
        <div style="color: rgb(38, 38, 38)">
          Made with
          <a
            href="https://squidfunk.github.io/mkdocs-material/"
            target="_blank"
            rel="noopener"
            style="color: black"
          >
            Material for MkDocs
          </a>
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["tabs", "instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>